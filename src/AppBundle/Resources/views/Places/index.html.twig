{% extends 'AppBundle:Admin:index.html.twig' %}

 {% block mainAdminContent %}
     <div class="page-title" xmlns="http://www.w3.org/1999/html">
         <h3>{{ "Places" | trans }}</h3>
     </div>

     <div class="row">
         <div class="col-md-12">
             <div class="grid simple">

                 <div class="grid-body no-border"> <br>
                     <div class="row">

                         <table class="table table-bordered">
                             <thead>
                                 <tr>
                                    <th>Группы</th>
                                    <th>Рубрики</th>
                                    <th>Блоки</th>
                                    <th>Действия</th>
                                    <th>CTR</th>
                                 </tr>
                             </thead>
                             <tbody>
                                {% for placeId, place in places %}
                                    <tr class="bg-purple" style="color:#fff;">
                                        <td colspan="5" data-id="{{ placeId }}"><h3>{{ place.name }}</h3></td>
                                    </tr>
                                    {% for r in place.row %}
                                        <tr>
                                            <td data-id="{{ r.g_id }}">{{ r.g_name }}</td>
                                            <td data-id="{{ r.r_id }}">{{ r.r_name }}</td>
                                            <td>-</td>
                                            <td>
                                                <div class="btn-group btn-group-sm">
                                                    <a href="{{ path('admin_edit_group', {id: r.g_id}) }}" title="Редактировать" class="btn"><i class="fa fa-pencil"></i></a>
                                                    <a href="" data-pid="{{ placeId }}" data-rid="{{ r.r_id }}" data-gid="{{ r.g_id }}" title="Получить код для вставки" class="btn btn-warning getEmbedCodeBtn"><i class="fa fa-cogs"></i></a>
                                                    <a href="" title="Клонировать" class="btn btn-primary"><i class="fa fa-files-o"></i></a>
                                                    <a href="" title="Статистика" class="btn btn-default"><i class="fa fa-bar-chart-o"></i></a>
                                                    <a href="" title="Удалить" class="btn btn-danger"><i class="fa fa-remove"></i></a>
                                                    <a href="" target="_blank" title="Открыть в новой вкладке" class="btn btn-default"><i class="fa fa-folder-o"></i></a>
                                                </div>
                                            </td>
                                            <td>-</td>
                                        </tr>
                                    {% endfor %}
                                {% endfor %}
                             </tbody>
                         </table>
                         <div class="clear clearfix"></div>
                     </div>
                 </div>
             </div>
         </div>
     </div>
 {% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript">
        var saveRubricsUrl = "{{ path('admin_add_rubrics') }}";
        var deleteRubricsUrl = "{{ path('admin_delete_rubrics') }}";
        var getEmbedCodeUrl = "{{ path('admin_places_get_embed_code') }}";

        $(document).ready(function(){
            $('a.getEmbedCodeBtn').on('click', function(e){
                e.preventDefault();

                var gid = $(this).data('gid')-0;
                var rid = $(this).data('rid')-0;
                var pid = $(this).data('pid')-0;

                $.post(getEmbedCodeUrl, {
                    gid: gid,
                    rid: rid,
                    pid: pid
                }, function(r){
                    if ( r.msg == 'success' ){
                        var modal = new MyAlert( "{{ 'Embed code' | trans }}", r.content );
                        modal.show();
                    }
                }, 'json');
                return false;
            });
        });

    </script>
    <script type="text/javascript" src="{{ asset('/bundles/app/js/settings/master.js') }}"></script>
{% endblock %}
